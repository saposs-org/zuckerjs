(function(win){win.zucker={utils:{ajax:function(e,n,t,r,i){try{win.XMLHttpRequest&&(i=new XMLHttpRequest("MSXML2.XMLHTTP.3.0")),win.ActiveXObject&&(i=new ActiveXObject("MSXML2.XMLHTTP.3.0")),i.open(r?"POST":"GET",e,1),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){i.readyState>3&&n&&n(i.responseText,t,i)},i.send(r)}catch(e){win.console&&console.log(e)}},combinePaths:function(e){return e.join("/")},getCurrentRoute:function(){var e=win.location.hash;return e&&""!==e&&"/"!==e||(e="#/"),e},getComponentUrl:function(e){return win.zucker.utils.combinePaths([win.zucker.options.componentFolder,win.zucker.options.selectedProjectIndex,e])},getView:function(e,n){win.zucker.utils.ajax(win.zucker.utils.getComponentUrl(e),n)},getTemplateIndex:function(e){for(var n=0;n<win.zucker.templates.length;n++)if(win.zucker.templates[n].name===e)return n},executeHandler:function(e,n){for(var t=0;t<win.zucker.handlers.length;t++)if(win.zucker.handlers[t].name===e)return win.zucker.handlers[t].execute(n)},executeService:function(e,n){for(var t=0;t<win.zucker.services.length;t++)if(win.zucker.services[t].name===e)return win.zucker.services[t].execute(n)},executeServicesByCurrentRoute:function(e){for(var n=win.zucker.utils.getCurrentRoute(),t=0;t<win.zucker.services.length;t++)"#"+win.zucker.services[t].route===n&&win.zucker.services[t].execute(e)}},defaultView:{},entryPointService:{execute:function(){}},views:[],templates:[],handlers:[],services:[],core:{install:function(){var zuckerCache=win.zucker.options.isCacheEnabled&&win.localStorage?win.localStorage.getItem(win.zucker.options.appName+"_zucker"):void 0;if(zuckerCache){for(var objCache=JSON.parse(zuckerCache),types=["views","handlers","services","templates"],i=0;i<types.length;i++)for(var j=0;j<objCache[types[i]].length;j++)win.zucker[types[i]].push(eval(objCache[types[i]][j]));win.zucker.defaultView=eval(objCache.defaultView),win.zucker.entryPointService=eval(objCache.entryPointService),win.zucker.entryPointService&&win.zucker.entryPointService.name&&(win.zucker.entryPointService.execute(win.zucker.options.entryPointArgs),win.zucker.services.push(win.zucker.entryPointService)),win.zucker.core.run()}else{var comps=win.zucker.options.components;if(0===comps.length)return;var obj={views:[],handlers:[],services:[],templates:[],defaultView:"",entryPointService:""},parseComponent=function(data,i){var comp=eval(data);"view"===comp.type?(comp.isDefault&&(win.zucker.defaultView=comp,obj.defaultView=data),win.zucker.views.push(comp),obj.views.push(data)):"handler"===comp.type?(win.zucker.handlers.push(comp),obj.handlers.push(data)):"service"===comp.type?(comp.isEntryPoint?(win.zucker.entryPointService=comp,win.zucker.options.isCacheEnabled&&(obj.entryPointService=data)):win.zucker.options.isCacheEnabled&&obj.services.push(data),win.zucker.services.push(comp)):"template"===comp.type&&(win.zucker.templates.push(comp),obj.templates.push(data)),i===comps.length-1?(win.zucker.entryPointService&&win.zucker.entryPointService.execute(win.zucker.options.entryPointArgs),win.zucker.options.isCacheEnabled&&win.localStorage&&win.localStorage.setItem(win.zucker.options.appName+"_zucker",JSON.stringify(obj)),win.zucker.core.run()):win.zucker.utils.ajax(win.zucker.utils.getComponentUrl(comps[i+1]+".js"),parseComponent,i+1)};win.zucker.utils.ajax(win.zucker.utils.getComponentUrl(comps[0]+".js"),parseComponent,0)}},run:function(){var e=win.document.getElementsByTagName(win.zucker.options.rootElementName)[0],n=window.location.hash,t=-1,r=0;n=n&&""!==n&&"/"!==n?win.location.hash:"/";var i=win.zucker.options.isCacheEnabled&&win.localStorage?win.localStorage.getItem(win.zucker.options.appName+"_zucker"+n):void 0,o=function(e){for(r=0;r<win.zucker.handlers.length;r++)win.zucker.handlers[r].route===e&&win.zucker.handlers[r].execute()};if(i)return e.outerHTML=i,o(n),void win.zucker.options.afterLoaded();var c=function(){var i=function(i){if(t>=0){for(e.innerHTML=win.zucker.templates[t].content+" "+i,r=0;r<win.zucker.templates[t].parts.length;r++){var c=win.zucker.templates[t].parts[r];win.document.getElementsByTagName(c)[0].outerHTML=win.document.getElementById(c).innerHTML,win.document.getElementById(c).outerHTML=""}win.localStorage.setItem(win.zucker.options.appName+"_zucker"+n,e.innerHTML),e.outerHTML=e.innerHTML}else win.localStorage.setItem(win.zucker.options.appName+"_zucker"+n,i),e.outerHTML=i;o(n),win.zucker.options.afterLoaded()};if("/"===n){if(t=win.zucker.utils.getTemplateIndex(win.zucker.defaultView.templateName),win.zucker.defaultView.get)return void win.zucker.defaultView.get(i)}else for(r=0;r<win.zucker.views.length;r++)if("#"+win.zucker.views[r].route===n)return t=win.zucker.utils.getTemplateIndex(win.zucker.defaultView.templateName),void win.zucker.views[r].get(i);o(n)};if(0!==win.zucker.templates.length){var u=function(e,n){win.zucker.templates[n].content=e,n===win.zucker.templates.length-1?c():win.zucker.templates[n+1].get(function(e){u(e,n+1)})};win.zucker.templates[0].get(function(e){u(e,0)})}else c()},check:function(){return!!win.localStorage||(console.log(win.zucker.options.messages[win.zucker.options.locale].localStorageErrorMsg),!1)},bootstrap:function(){win.zucker.core.check()&&(win.zucker.options.beforeLoad(),win.zucker.core.install())}},options:{appName:"zucker",componentFolder:"archives",base:"base",selectedProjectIndex:0,isCacheEnabled:!0,beforeLoad:function(){},afterLoaded:function(){},locale:"en",version:"v0.1.0 beta",messages:{en:{localStorageErrorMsg:"The local storage wasn't supported on your browser. The caching feature in ZuckerJS won't work anymore because ZuckerJS uses local storage to cache all components."}},components:[],rootElementName:"zucker",entryPointArgs:null},before:function(e){return win.zucker.options.beforeLoad=e,win.zucker},after:function(e){return win.zucker.options.afterLoaded=e,win.zucker},setAppName:function(e){return win.zucker.options.appName=e,win.zucker},setEntryPointArgs:function(e){return win.zucker.options.entryPointArgs=e,win.zucker},execute:function(){return win.zucker.core.bootstrap(),win.zucker},config:function(e){return win.zucker.options.components=e,win.zucker}}})(window);